@model AdvanceCRM.Reports.InventoryReportModel

<!--<div style="text-align:center"><strong>All Branches Product-wise Stock Report </strong></div>
<hr />
<table style="width:100%; border:groove" , border="1">
    <tr><th style="text-align:center">Sr. No.</th><th style="text-align:center">Product</th><th style="text-align:center">Branch</th><th style="text-align:center">Quantity</th><th style="text-align:center">Avg Value</th>@*<th style="text-align:center">Current Value</th>*@</tr>

 @*   @{ int cnt = 1; double pqty = 0; double sqty = 0; double prqty = 0; double srqty = 0; double cqty = 0; double qty = 0; double stfqty = 0; double sttqty = 0;}

    @foreach (var item in Model.Products)
    {
        int count = Model.AllBranch.Count();

        foreach (var branch in Model.AllBranch)
        {
            double avgsum = 0;

            pqty = (double)Model.PurchaseProducts.Where(y => y.ProductsName == item.Name && y.PurchaseBranchId == branch.Id).Sum(x => x.Quantity);

            sqty = (double)Model.SalesProducts.Where(y => y.ProductsName == item.Name && y.SalesBranchId == branch.Id).Sum(x => x.Quantity);

            prqty = (double)Model.PurchaseReturnProducts.Where(y => y.ProductsName == item.Name && y.PurchaseReturnBranchId == branch.Id).Sum(x => x.Quantity);


            srqty = (double)Model.SalesReturnProducts.Where(y => y.ProductsName == item.Name && y.SalesReturnBranchId == branch.Id).Sum(x => x.Quantity);

            cqty = (double)Model.ChallanProducts.Where(y => y.ProductsName == item.Name && y.ChallanBranchId == branch.Id).Sum(x => x.Quantity);

            stfqty = (double)Model.StockTransferFrom.Where(y => y.ProductsName == item.Name && y.StockTransferFromBranchId == branch.Id).Sum(x => x.Quantity);

            sttqty = (double)Model.StockTransferTo.Where(y => y.ProductsName == item.Name && y.StockTransferToBranchId == branch.Id).Sum(x => x.Quantity);

            qty = (pqty + srqty + sttqty) - (sqty + prqty + cqty + stfqty);

            if (pqty > 0)
            {
                avgsum = (double)Model.PurchaseProducts.Where(y => y.ProductsName == item.Name && y.PurchaseBranchId == branch.Id).Average(x => x.Price);
            }



            //if (qty != 0)
            //{
            <tr>
                <td style="text-align:center; width:20%">
                    @cnt
                </td>
                <td>
                    &nbsp;&nbsp;@item.Name
                </td>
                <td>
                    @branch.Branch
                </td>
                <td style="text-align:right">
                    @qty &nbsp;&nbsp;
                </td>
                <td style="text-align:right">
                    @{double amt = avgsum * qty;}
                    @amt.ToString("#,##0.00") &nbsp;&nbsp;
                </td>
                @*<td>
                            @{double actamt = (double)item. * pqty;}
                            &nbsp;&nbsp; @amt
                    </td>*@
            </tr>
            cnt = cnt + 1;
        }
     }
</table>-->

<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
    }

    .report-container {
        width: 100%;
        max-width: 1200px;
        margin: auto;
        background: #ffffff;
        padding: 20px;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
    }

    .report-title {
        font-size: 22px;
        font-weight: bold;
        text-align: center;
        color: #333;
        margin-bottom: 15px;
    }

    .report-subtitle {
        text-align: center;
        font-size: 14px;
        color: #555;
        margin-bottom: 20px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.1);
    }

    th, td {
        padding: 12px;
        border: 1px solid #ddd;
        text-align: center;
    }

    th {
        background: #007bff;
        color: #ffffff;
        font-size: 14px;
        font-weight: bold;
        text-transform: uppercase;
    }

    tr:nth-child(even) {
        background: #e3e3e3;
    }

    tr:hover {
        background: #f1f1f1;
        transition: 0.3s;
    }

    .footer-note {
        text-align: center;
        font-size: 12px;
        margin-top: 15px;
        color: #777;
    }
</style>

<div style="font-size: 16px; font-weight: bold; margin-bottom: 10px;">
    All Branches Product-wise Stock Report
</div>

<table style="width:100%; border:groove" , border="1">
    <tr>
        <th style="text-align:center">Sr. No.</th>
        <th style="text-align:center">Product</th>
        <th style="text-align:center">Branch</th>
        <th style="text-align:center">Quantity</th>
        <th style="text-align:center">Avg Value</th>
        @*<th style="text-align:center">Current Value</th>*@
    </tr>

    @{ int cnt = 1; }

    @foreach (var item in Model.Products)
    {
        foreach (var branch in Model.AllBranch)
        {
            double pqty = Model.PurchaseProducts.Where(y => y.ProductsName == item.Name && y.PurchaseBranchId == branch.Id).Sum(x => (double)x.Quantity);
            double sqty = Model.SalesProducts.Where(y => y.ProductsName == item.Name && y.SalesBranchId == branch.Id).Sum(x => (double)x.Quantity);
            double prqty = Model.PurchaseReturnProducts.Where(y => y.ProductsName == item.Name && y.PurchaseReturnBranchId == branch.Id).Sum(x => (double)x.Quantity);
            double srqty = Model.SalesReturnProducts.Where(y => y.ProductsName == item.Name && y.SalesReturnBranchId == branch.Id).Sum(x => (double)x.Quantity);
            double cqty = Model.ChallanProducts.Where(y => y.ProductsName == item.Name && y.ChallanBranchId == branch.Id).Sum(x => (double)x.Quantity);
            double stfqty = Model.StockTransferFrom.Where(y => y.ProductsName == item.Name && y.StockTransferFromBranchId == branch.Id).Sum(x => (double)x.Quantity);
            double sttqty = Model.StockTransferTo.Where(y => y.ProductsName == item.Name && y.StockTransferToBranchId == branch.Id).Sum(x => (double)x.Quantity);

            double qty = (pqty + srqty + sttqty) - (sqty + prqty + cqty + stfqty);

            if (qty != 0)
            {
                double avgsum = 0;
                if (pqty > 0)
                {
                    avgsum = Model.PurchaseProducts.Where(y => y.ProductsName == item.Name && y.PurchaseBranchId == branch.Id).Average(x => (double)x.Price);
                }
                double amt = avgsum * qty;

                <tr>
                    <td>@cnt</td>
                    <td>@item.Name</td>
                    <td>@branch.Branch</td>
                    <td>@qty.ToString("#,##0")</td>
                    <td>@amt.ToString("#,##0.00")</td>
                </tr>
cnt++;
            }
        }
    }
</table>

<div class="footer-note">
    <em>Report generated automatically. Powered by BizPlus ERP.</em>
</div>