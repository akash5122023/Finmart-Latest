@model AdvanceCRM.Reports.TasksReportModel
@{
    Layout = MVC.Views.Shared._LayoutNoNavigation;
    ViewData["Title"] = "SignIn Report";
    ViewData["IgnoreImmediatePrint"] = "Yes";
}

<!--<body>
    <table style="width:100%; border:groove;">
        <tr>
            <td align="center">
                <h3 style="text-decoration-color:burlywood">@Model.Company.Name</h3>
                <h4>@Model.Company.Address</h4>
                <h5>@Model.Company.Phone</h5>
            </td>
        </tr>
    </table>
    <div>
        <h4 style="text-align:center"><strong>Tasks Report</strong></h4>
    </div>
    <br />
    <div style="text-align:center">
        &nbsp;&nbsp;  &nbsp;&nbsp; <strong>From:</strong> @Model.Request.DateFrom.ToDateFormat() <strong> To: </strong> @Model.Request.DateTo.ToDateFormat() - &nbsp;&nbsp; <strong>Representative: </strong> @Model.Users.DisplayName
        (@Model.Users.Username)
    </div>
    <hr />
    <hr />
    <table style="width:100%; border:groove" , border="1">
        <tr>
            <th style="text-align:center" width="2%">Sr. No.</th>
            <th style="text-align:center" width="6%">CreatedBy</th>
            <th style="text-align:center" width="16%">Project</th>
            <th style="text-align:center" width="16%">Task</th>
            <th style="text-align:center" width="15%">Created Date</th>
            <th style="text-align:center" width="15%">Ex.Completion Date</th>
            <th style="text-align:center" width="15%">Completion Date</th>
            <th style="text-align:center" width="15%">FeedBack</th>

        </tr>
        @*{ int cnt = 1; double d = 0;}*@

        @foreach (var item in Model.all)
        {
            //tTime = 0;

            //tDays = (double)Model.all.Where(y => y.NameDisplayName == item.DisplayName).Where(z => z.Type.Value.GetText() == "In").Count();

            //lst = Model.Attendance.Where(z => z.NameDisplayName == item.DisplayName).Where(x => x.Type.Value.GetText() == "In").ToList<AttendanceRow>
            //    ();

            //foreach (var itm in lst)
            //{
            //    var inTime = Model.Attendance.Where(z => z.DateNTime.Value.ToShortDateString() == itm.DateNTime.Value.ToShortDateString()).Where(y => y.Type.Value.GetText() == "In").Where(x => x.NameDisplayName == item.DisplayName);

            //    var outTime = Model.Attendance.Where(z => z.DateNTime.Value.ToShortDateString() == itm.DateNTime.Value.ToShortDateString()).Where(y => y.Type.Value.GetText() == "Out").Where(x => x.NameDisplayName == item.DisplayName);

            //    if (inTime.Count() > 0)
            //    {
            //        if (outTime.Count() > 0)
            //        {
            //            tTime = tTime + (outTime.FirstOrDefault().DateNTime.Value.Subtract(inTime.FirstOrDefault().DateNTime.Value).TotalMinutes);
            //        }
            //    }
            //}

            <tr>

                @{
                    var feedback = ""; var color = "white";
                    if (item.StatusId == 2)
                    {
                        DateTime date1 = Convert.ToDateTime(item.ExpectedCompletion);
                        DateTime date2 = Convert.ToDateTime(item.CompletionDate);
                        if (item.ExpectedCompletion < item.CompletionDate)
                        {
                            TimeSpan days = date2.Subtract(date1);

                            feedback = days + " Ouerdue";
                            color = "Red";

                        }
                        else if (item.ExpectedCompletion > item.CompletionDate)
                        {
                            TimeSpan days = date1.Subtract(date2);
                            feedback = days + " Before-Time";
                            color = "Green";
                        }
                        else if (item.ExpectedCompletion == item.CompletionDate)
                        {
                            TimeSpan days = date1.Subtract(date2);

                            feedback = days + " In-Time";
                            color = "Yellow";
                        }
                    }
                }
                <td style="text-align:center;">
                    @*cnt*@
                </td>

                <td>
                    @* &nbsp;&nbsp;@Html.DisplayFor(x => item)*@
                    @item.AssignedByDisplayName
                </td>
                <td>@item.Project</td>
                <td>@item.Task</td>
                <td>
                    @item.CreationDate
                </td>
                <td>@item.ExpectedCompletion</td>
                <td>@item.CreationDate</td>
                @if (color == "Red")
                {
                    <td style="background-color:red;color:white">@feedback</td>
                }
                else if (color == "Yellow")
                {
                    <td style="background-color: yellow; color: white">@feedback</td>
                }
                else if (color == "Green")
                {
                    <td style="background-color: green; color: white">@feedback</td>
                }
            </tr>

                        //cnt = cnt + 1;

                    }
    </table>

</body>-->

<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
    }

    .report-container {
        width: 100%;
        max-width: 1200px;
        margin: auto;
        background: #ffffff;
        padding: 20px;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
    }

    .report-title {
        font-size: 22px;
        font-weight: bold;
        /* text-align: center;*/
        color: #333;
        margin-bottom: 15px;
    }

    .report-subtitle {
        /*text-align: center;*/
        font-size: 14px;
        color: #555;
        margin-bottom: 20px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.1);
    }

    th, td {
        padding: 12px;
        border: 1px solid #ddd;
        /* text-align: center;
        */
    }

    th {
        background: #007bff;
        color: #ffffff;
        font-size: 14px;
        font-weight: bold;
        text-transform: uppercase;
    }

    tr:nth-child(even) {
        background: #e3e3e3;
    }

    tr:hover {
        background: #f1f1f1;
        transition: 0.3s;
    }

    .footer-note {
        text-align: center;
        font-size: 12px;
        margin-top: 15px;
        color: #777;
    }
</style>

<body style="font-family: Arial, sans-serif; margin: 20px;">

    <table style="width:100%; border: 2px solid #333; border-collapse: collapse; text-align: center; background: #f8f9fa; padding: 10px;">
        <tr>
            <td>
                <h2 style="color: #2c3e50; margin-bottom: 5px;">@Model.Company.Name</h2>
                <h4 style="color: #7f8c8d; margin: 0;">@Model.Company.Address</h4>
                <h5 style="color: #16a085; margin-top: 5px;">@Model.Company.Phone</h5>
            </td>
        </tr>
    </table>

    <div style="font-size: 16px; font-weight: bold; margin-bottom: 10px;">
        Tasks Report
    </div>

    <div style="font-size: 14px; margin-bottom: 5px;">
        <strong>From:</strong> @Model.Request.DateFrom.ToDateFormat() &nbsp;
        <strong>To:</strong> @Model.Request.DateTo.ToDateFormat()<br />
        <strong>Representative: </strong> @Model.Users.DisplayName
        (@Model.Users.Username)
    </div>

    <table style="width:100%; border:groove" , border="1">
        <tr>
            <th style="text-align:center" width="2%">Sr. No.</th>
            <th style="text-align:center" width="6%">CreatedBy</th>
            <th style="text-align:center" width="16%">Project</th>
            <th style="text-align:center" width="16%">Task</th>
            <th style="text-align:center" width="15%">Created Date</th>
            <th style="text-align:center" width="15%">Ex.Completion Date</th>
            <th style="text-align:center" width="15%">Completion Date</th>
            <th style="text-align:center" width="15%">FeedBack</th>

        </tr>
        @{ int count = 1; double d = 0;}

        @foreach (var item in Model.all)
        {
            //tTime = 0;

            //tDays = (double)Model.all.Where(y => y.NameDisplayName == item.DisplayName).Where(z => z.Type.Value.GetText() == "In").Count();

            //lst = Model.Attendance.Where(z => z.NameDisplayName == item.DisplayName).Where(x => x.Type.Value.GetText() == "In").ToList<AttendanceRow>
            //    ();

            //foreach (var itm in lst)
            //{
            //    var inTime = Model.Attendance.Where(z => z.DateNTime.Value.ToShortDateString() == itm.DateNTime.Value.ToShortDateString()).Where(y => y.Type.Value.GetText() == "In").Where(x => x.NameDisplayName == item.DisplayName);

            //    var outTime = Model.Attendance.Where(z => z.DateNTime.Value.ToShortDateString() == itm.DateNTime.Value.ToShortDateString()).Where(y => y.Type.Value.GetText() == "Out").Where(x => x.NameDisplayName == item.DisplayName);

            //    if (inTime.Count() > 0)
            //    {
            //        if (outTime.Count() > 0)
            //        {
            //            tTime = tTime + (outTime.FirstOrDefault().DateNTime.Value.Subtract(inTime.FirstOrDefault().DateNTime.Value).TotalMinutes);
            //        }
            //    }
            //}

            <tr>

                @{
                    var feedback = ""; var color = "white";
                    if (item.StatusId == 2)
                    {
                        DateTime date1 = Convert.ToDateTime(item.ExpectedCompletion);
                        DateTime date2 = Convert.ToDateTime(item.CompletionDate);
                        if (item.ExpectedCompletion < item.CompletionDate)
                        {
                            TimeSpan days = date2.Subtract(date1);

                            feedback = days + " Ouerdue";
                            color = "Red";

                        }
                        else if (item.ExpectedCompletion > item.CompletionDate)
                        {
                            TimeSpan days = date1.Subtract(date2);
                            feedback = days + " Before-Time";
                            color = "Green";
                        }
                        else if (item.ExpectedCompletion == item.CompletionDate)
                        {
                            TimeSpan days = date1.Subtract(date2);

                            feedback = days + " In-Time";
                            color = "Yellow";
                        }
                    }
                }
                <td style="text-align:center;">
                    @count
                </td>

                <td>
                    @* &nbsp;&nbsp;@Html.DisplayFor(x => item)*@
                    @item.AssignedByDisplayName
                </td>
                <td>@item.Project</td>
                <td>@item.Task</td>
                <td>
                    @item.CreationDate
                </td>
                <td>@item.ExpectedCompletion</td>
                <td>@item.CreationDate</td>
                @if (color == "Red")
                {
                    <td style="background-color:red;color:white">@feedback</td>
                }
                else if (color == "Yellow")
                {
                    <td style="background-color: yellow; color: white">@feedback</td>
                }
                else if (color == "Green")
                {
                    <td style="background-color: green; color: white">@feedback</td>
                }
            </tr>

            count = count + 1;

        }
    </table>

</body>
