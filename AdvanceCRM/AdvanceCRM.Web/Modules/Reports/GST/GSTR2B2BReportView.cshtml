
@model AdvanceCRM.Modules.Reports.GST.GSTR2B2BPageModel
@{
	ViewBag.Title = "GSTR2B2BReportView";
}


<link rel="stylesheet" href="~/Scripts/daterangepicker/daterangepicker-bs3.css" />
@*<link rel="stylesheet" href="~/Content/iCheck/all.css" />*@
<link rel="stylesheet" href="~/Scripts/colorpicker/bootstrap-colorpicker.min.css" />
<link rel="stylesheet" href="~/Scripts/timepicker/bootstrap-timepicker.min.css" />

<script src="~/Scripts/input-mask/jquery.inputmask.js"></script>
<script src="~/Scripts/input-mask/jquery.inputmask.date.extensions.js"></script>
<script src="~/Scripts/input-mask/jquery.inputmask.extensions.js"></script>
<script src="~/Scripts/daterangepicker/moment.min.js"></script>
<script src="~/Scripts/daterangepicker/daterangepicker.js"></script>
<script src="~/Scripts/colorpicker/bootstrap-colorpicker.min.js"></script>
<script src="~/Scripts/timepicker/bootstrap-timepicker.min.js"></script>
@*<script src="~/Scripts/jquery.icheck.min.js"></script>*@


<script type="text/javascript">
	$(function () {
			$('input[name="GSTR2B2BDateRange"]').daterangepicker({
								startDate: '@System.DateTime.Now.AddMonths(-1).ToString("MM/dd/yyyy")',
								endDate: '@System.DateTime.Now.ToString("MM/dd/yyyy")'
			});

			//On date change GSTR1B2B
			$('input[name="GSTR2B2BDateRange"]').on('apply.daterangepicker', function (ev, picker) {

				var sDate = picker.startDate.format('MM/DD/YYYY');
				var eDate = picker.endDate.format('MM/DD/YYYY');

				$(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));
				$("#StartDate").val(picker.startDate.format('MM/DD/YYYY'));
				$("#EndDate").val(picker.endDate.format('MM/DD/YYYY'));

				$.ajax(
				{
					url:'@Url.Action("LoadData", "GSTR2")?StartDate=' + picker.startDate.format('MM/DD/YYYY') + '&EndDate=' + picker.endDate.format('MM/DD/YYYY'),
					type: 'GET',
					data: "",
					contentType: 'application/json; charset=utf-8',
					success: function (data) {
						$("#LoadB2BPartialViewDataDiv").html(data);
					},
					error: function () {
						toastr.error(data);
					}
				});


			});
			//End of GSTR2B2B
	});



	function ExportToCSV()
	{
		filename = "GSTR2B2B.csv";
		$.ajax({
			type: "POST",
			url: '@Url.Action("ExportCSVB2B", "GSTR2")',
			data: { StartDate: $("#StartDate").val(), EndDate: $("#EndDate").val()},
			success: function (data) {
				if (data == "") {
					data = "No data available for selected date range";
				}

				var file = new Blob([data], { type: 'text/csv;charset=utf-8;' });
				if (window.navigator.msSaveOrOpenBlob) // IE10+
					window.navigator.msSaveOrOpenBlob(file, "GSTR2B2B");
				else { // Others
					var a = document.createElement("a"),
						url = URL.createObjectURL(file);
					a.href = url;
					a.download = filename;
					document.body.appendChild(a);
					a.click();
					setTimeout(function () {
						document.body.removeChild(a);
						window.URL.revokeObjectURL(url);
					}, 0);
				}
			},
			error: function (data) {
				toastr.error(data, 'Error',
					{
						"closeButton": true,
						"debug": false,
						"newestOnTop": true,
						"progressBar": false,
						"positionClass": "toast-top-full-width",
						"preventDuplicates": true,
						"onclick": null,
						"showDuration": "300",
						"hideDuration": "3000",
						"timeOut": 0,
						"extendedTimeOut": 0,
						"tapToDismiss": false,
						"allowHtml": true
					});
			}

		});
	}


</script>


@Html.HiddenFor(m => m.StartDate)
@Html.HiddenFor(m => m.EndDate)
<div class="s-DataGrid require-layout route-handler responsive-height" style="height: auto;">
    <div class="grid-title"><div class="title-text">GSTR-2 B2B Report</div></div>
    <br />

    <div class="row">
        <div class="form-group col-sm-12">
            <div class="form-group col-sm-3"></div>
            <!-- Date range -->
            <div class="form-group col-sm-2">
                <label class="col-form-label pull-right">Date range:</label>
            </div>

            <div class="form-group col-sm-5">
                <div style='text-align:left;'>

                    <div class="input-group">
                        <div class="input-group-addon">
                            <i class="fa fa-calendar"></i>
                        </div>
                        <input type="text" class="form-control pull-right" name="GSTR2B2BDateRange" id="GSTR2B2BDateRange">
                    </div><!-- /.input group -->
                </div>
            </div><!-- /.form group -->
            <!-- Date and time range -->
            <div class="form-group col-sm-2">
                <button type="button" id="ExportCSV" name="ExportCSV" class="form-group btn btn-block" title="Export to CSV" onclick="ExportToCSV();">Export to CSV</button>
            </div>

        </div>
    </div>
    <br />
    <div id="LoadB2BPartialViewDataDiv" style="width:100%">
    </div>
</div>



